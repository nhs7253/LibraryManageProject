<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.library.dao.config.mapper.bookMapper">

	<sql id="all-column">
		book_id,
		title,
		author,
		publisher,
		publish_date,
		rental_state
	</sql>
	
	 <resultMap type="book" id="book-resultmap">
	 	<id column="book_id" property="bookId"/>
	 	<result column="title" property="title"/>
	 	<result column="author" property="author"/>
	 	<result column="publisher" property="publisher"/>
	 	<result column="publish_date" property="publishDate"/>
	 	<result column="rental_state" property="rentalState"/>
	 </resultMap>
	
	<insert id="insertBook" parameterType="book">
		INSERT INTO book
		VALUES (#{bookId},
				#{title},
				#{author},
				#{publisher},
				#{publishDate},
				#{rentalState})
	</insert>
	
	<update id="updateBook" parameterType="book">
		UPDATE book
		SET title = #{title},
			author = #{author},
			publisher = #{publisher},
			publish_date = #{publishDate},
			rental_state = #{rentalState}
		WHERE book_id = #{bookId}
	</update>
	
	<update id="updateRentalState" parameterType="map">
		UPDATE book
		SET rental_state = #{rentalState}
		WHERE book_id = #{bookId}
	</update>
	
	<delete id="deleteBook" parameterType="string">
		DELETE FROM book
		WHERE book_id = #{value}
	</delete>
	
	<select id="selectBookList" resultMap="book-resultmap">
		SELECT <include refid="all-column"/>
		FROM book
		ORDER BY title
	</select>
	
	<select id="selectBookListById" parameterType="string" resultMap="book-resultmap">
		SELECT <include refid="all-column"/>
		FROM book
		WHERE book_id = #{value}
	</select>
	
	<select id="selectBookListByTitle" parameterType="string" resultMap="book-resultmap">
		SELECT <include refid="all-column"/>
		FROM book
		WHERE title LIKE '%'||#{value}||'%'
		ORDER BY title
	</select>
	
	<select id="selectBookCount" resultType="int">
		SELECT COUNT(*)
		FROM book
	</select>
	
	<select id="selectBookByTitleCount" resultType="int" parameterType="string">
		SELECT COUNT(*)
		FROM book
		WHERE title LIKE '%'||#{value}||'%'
	</select>
	
	<select id="selectBookPaging" parameterType="map" resultMap="book-resultmap">
		SELECT * FROM (
   		SELECT book.*, ROW_NUMBER() OVER(ORDER BY title ASC) AS RNUM
    	FROM book)
		WHERE RNUM BETWEEN #{startIndex} AND #{endIndex}
	</select>
	
	<select id="selectBookPagingByTitle" parameterType="map" resultMap="book-resultmap">
		SELECT * FROM (
   		SELECT book.*, ROW_NUMBER() OVER(ORDER BY title ASC) AS RNUM
    	FROM book
    	WHERE book.title LIKE '%'||#{title}||'%')
		WHERE RNUM BETWEEN #{startIndex} AND #{endIndex}
	</select>
	
	
	
	<select id="selectBookListByAuthor" parameterType="string" resultMap="book-resultmap">
		SELECT <include refid="all-column"/>
		FROM book
		WHERE title LIKE '%'||#{value}||'%'
		ORDER BY title
	</select>
	
	<select id="selectBookByAuthorCount" resultType="int" parameterType="string">
		SELECT COUNT(*)
		FROM book
		WHERE title LIKE '%'||#{value}||'%'
	</select>
	
	
</mapper>